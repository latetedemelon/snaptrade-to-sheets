<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; font-size: 12px; }
    th { background: #f1f3f4; }
    .pill { padding: 4px 8px; border-radius: 12px; font-weight: bold; color: white; font-size: 11px; }
    .yes { background: #34a853; }
    .no { background: #c5221f; }
    #status { margin-bottom: 10px; color: #5f6368; }
  </style>
</head>
<body>
  <h3>Brokerage Capabilities</h3>
  <div id="status">Loading broker data...</div>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Country</th>
        <th>Trading</th>
        <th>Orders</th>
      </tr>
    </thead>
    <tbody id="brokers"></tbody>
  </table>

  <script>
    function render(brokers) {
      const body = document.getElementById('brokers');
      body.innerHTML = '';
      brokers.forEach(function(broker) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${broker.name}</td>
          <td>${broker.country || ''}</td>
          <td><span class="pill ${broker.allows_trading ? 'yes' : 'no'}">${broker.allows_trading ? 'Yes' : 'No'}</span></td>
          <td>${broker.features ? broker.features.join(', ') : 'â€”'}</td>
        `;
        body.appendChild(row);
      });
      document.getElementById('status').textContent = `${brokers.length} brokerages loaded.`;
    }

    function showError(err) {
      document.getElementById('status').textContent = 'Error: ' + (err.message || err);
    }

    google.script.run
      .withSuccessHandler(render)
      .withFailureHandler(showError)
      .getBrokerageMetadata();
  </script>
</body>
</html>
